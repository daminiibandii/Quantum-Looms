<!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>Handloom Quantum Assignment Demo</title>
      <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 24px; }
        h1 { margin-bottom: 8px; }
        textarea { width: 100%; height: 120px; }
        button { padding: 10px 16px; margin-top: 8px; cursor: pointer; }
        .row { display:flex; gap:16px; align-items:flex-start; }
        .card { border:1px solid #ddd; border-radius:12px; padding:16px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        table { border-collapse: collapse; width: 100%; margin-top: 8px; }
        th, td { border: 1px solid #ddd; padding: 6px 8px; text-align: center; }
        .small { font-size: 12px; color: #666; }
        .grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
        @media (max-width: 900px){ .grid { grid-template-columns: 1fr; } }
        code { background: #f6f8fa; padding: 2px 4px; border-radius: 6px; }
      </style>
    </head>
    <body>
      <h1>Handloom Quantum Assignment Demo</h1>
      <p class="small">Enter a cost matrix with rows = orders and columns = weavers. Example has 5 orders Ã— 3 weavers.</p>

      <div class="grid">
        <div class="card">
          <h3>Input</h3>
          <label>Cost Matrix (comma-separated rows):</label>
          <textarea id="matrixInput">3,6,2
4,3,5
2,4,3
6,2,4
5,3,6</textarea>

          <label>Penalty (QUBO constraint strength)</label>
          <input id="penalty" type="number" value="10" step="1" min="1"/>

          <label>Solver</label>
          <select id="solver">
            <option value="quantum_local">Quantum (local simulated annealing)</option>
            <option value="classical">Classical only</option>
          </select>

          <button id="runBtn">Optimize</button>
          <p class="small">Backend must be running at <code>http://127.0.0.1:8000</code>.</p>
        </div>

        <div class="card">
          <h3>Results</h3>
          <div id="results"></div>
        </div>
      </div>

      <script>
        function parseMatrix(text) {
          return text
            .trim()
            .split(/[\r\n]+/)
            .map(line => line.split(",").map(n => parseFloat(n.trim())));
        }

        function renderTable(title, data) {
          const rows = data.assignment.map(item => `
            <tr><td>${item.order}</td><td>${item.weaver}</td><td>${item.cost}</td></tr>
          `).join("");
          return `
            <h4>${title}</h4>
            <table>
              <thead><tr><th>Order</th><th>Weaver</th><th>Cost</th></tr></thead>
              <tbody>${rows}</tbody>
              <tfoot><tr><td colspan="2"><b>Total</b></td><td><b>${data.total_cost}</b></td></tr></tfoot>
            </table>
          `;
        }

        async function optimize() {
          const matrix = parseMatrix(document.getElementById("matrixInput").value);
          const penalty = parseFloat(document.getElementById("penalty").value || "10");
          const solver = document.getElementById("solver").value;

          const payload = { cost_matrix: matrix, penalty, solver };
          const res = await fetch("http://127.0.0.1:8000/optimize", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });
          const json = await res.json();

          const classicalHTML = renderTable("Classical (CP-SAT)", json.classical);
          const quantumHTML   = renderTable("Quantum (local SA)", json.quantum);

          document.getElementById("results").innerHTML = classicalHTML + quantumHTML;
        }

        document.getElementById("runBtn").addEventListener("click", optimize);
      </script>
    </body>
    </html>
